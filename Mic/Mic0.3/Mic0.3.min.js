 var mic=function(a){return new Mic(a)};function Mic(a){this.init(a)}Mic.prototype.init=function(f){var a=this;this["$data"]={};this["$methods"]={};this["$vdom"]=document.getElementById(f.el.substr(1));var d=document.getElementById(f.el.substr(1));var c=d.cloneNode(true);d.parentElement.insertBefore(c,d);d.parentElement.removeChild(d);var b=new Proxy(a,{get:function(i,g,h){return i[g]},set:function(j,h,i){if(j[h]===undefined){j[h]=i}else{var g=j[h].toString();var k=i.toString();if((typeof j[h]!==typeof i)||(g!==k)){j[h]=i;a.reloadDom(f,b,h,i)}}}});var e=new Promise(function(){});e.then(this.initData(f,a)).then(this.execCreated(f,b)).then(this.initDom(f,b,c)).then(this.execAction(f,b,c)).then(this.execMounted(f,b)).then(this.runRemove(f,b))};Mic.prototype.initData=function(b,a){if(b.data){for(name in b.data){if((typeof b.data[name]=="function")){console.error("data內請不要定義函數");return false}else{a[name]=b.data[name];a["$data"][name]=b.data[name]}}}if(b.methods){for(name in b.methods){if(typeof b.methods[name]=="function"){a[name]=b.methods[name];a["$methods"][name]=b.methods[name]}else{console.error("methods內請定義函數");return false}}}};Mic.prototype.execCreated=function(b,a){if(b.created){b.created.call(a)}};Mic.prototype.initDom=function(n,q,l){var d=l;var x=offspring(d);var C=collection(x,"m-for");var f=C.attCol;var t=C.elsCol;if(C){for(var v=0;v<f.length;v++){evalFor(v,f,t,q)}}x=offspring(d);var k=nodesCollection(x);if(k){for(var v=0;v<k.length;v++){if(k[v].parent.__mic__.attributes===undefined){k[v].parent.__mic__.attributes={}}if(k[v].parent.__mic__.attributes.braces===undefined){k[v].parent.__mic__.attributes.braces=k[v]}evalBraces(k[v],q)}}var y=collection(x,"m-text");var p=y.attCol;var b=y.elsCol;if(y){for(var v=0;v<p.length;v++){evalText(v,p,b,q)}}x=offspring(d);var o=collection(x,"m-if");var a=o.attCol;var h=o.elsCol;o.comments=[];if(o){for(var v=0;v<a.length;v++){o.comments[v]=document.createComment("");h[v].parent=h[v].parentNode;evalIf(v,o,q)}}x=offspring(d);var z=syncCollection(x,"m-model");var c=z.attCol;var B=z.elsCol;var g=z.valCol;y=syncCollection(x,"m-text");p=y.attCol;b=y.elsCol;textValCol=y.valCol;var s=syncCollection(x,"braces");if(z){var e={};for(var v=0;v<c.length;v++){e=B[v];var r=g[v];var w=new RegExp("(\\+|-|\\*|/|%|s|(|^)+"+r+"(\\+|-|\\*|/|%|s|)|$)+");e.value=q[r];if(y){for(var u=0;u<p.length;u++){var A=b[u];var m=textValCol[u];if(m.search(w)>=0){A.__mic__.text=m}}}if(e.oninput!==undefined){if(isIE9){e.onkeydown=function(i){if((i.keyCode==8)||(i.keyCode==46)||(i.ctrlKey&&i.keyCode==88)){e.fireEvent("onkeyup")}};e.onkeyup=function(i){e.fireEvent("oninput")}}e.oninput=function(){r=this.__mic__.attributes["m-model"];q[r]=this.value?this.value:"+''";modelTextEval(q,y,r,w);modelBracesEval(q,s,r,w)}}else{e.onpropertychange=function(){r=this.__mic__.attributes["m-model"];q[r]=this.value?this.value:"+''";modelTextEval(q,y,r,w);modelBracesEval(q,s,r,w)}}}}};Mic.prototype.reloadDom=function(k,o,w,n){var f=o["$vdom"];var c=document.getElementById(k.el.substr(1));var g=offspring(f);var t=offspring(c);var v=syncCollection(g,"m-for");var e=v.attCol;var q=v.elsCol;if(v){for(var s=0;s<e.length;s++){if(q[s].__mic__.attributes["m-text"]===w){evalFor(s,e,q,o)}}}var p=syncCollection(t,"braces");var d=p.attCol;var l=p.elsCol;if(p){for(var s=0;s<l.length;s++){var h=l[s].__mic__.attributes.braces;for(var r=0;r<h.data.length;r++){var a=alltrim(h.data[r].replace("{{","").replace("}}",""));if(a===w){evalBraces(h,o)}}}}var u=syncCollection(t,"m-text");var m=u.attCol;var b=u.elsCol;if(u){for(var s=0;s<m.length;s++){if(b[s].__mic__.attributes["m-text"]===w){evalText(s,m,b,o)}}}if(o.$vdom.ifc){for(var s=0;s<o.$vdom.ifc.attCol.length;s++){evalIf(s,o.$vdom.ifc,o)}}};Mic.prototype.execMounted=function(b,a){if(b.mounted){b.mounted.call(a)}};Mic.prototype.execAction=function(obj,root,element){var eleOffspring=offspring(element);var actionCollection=syncCollection(eleOffspring,"@");var actionAttCol=actionCollection.attCol;var actionElsCol=actionCollection.elsCol;if(actionCollection){for(var i=0;i<actionAttCol.length;i++){var actionName=actionAttCol[i].slice(1);actionElsCol[i].addEventListener(actionName,function(){var onData=this.__mic__.data;var action=this.__mic__.attributes["@"+actionName];if(action.search(/(\()/)>0){var sf=action.split("(");var paramString=sf[1].replace(")","");var params=paramString.split(",");var param=[];params.forEach(function(item,index){if(onData[item]!==undefined){param.push("'"+onData[item]+"'")}else{param.push("root."+item)}});param=param.join(",");var ec="root."+sf[0]+"("+param+")";eval(ec)}else{root[action]()}})}}};Mic.prototype.runRemove=function(f,a){var e=document.getElementById(f.el.substr(1));var g=offspring(e);var c=["m-text","m-if","@",":","m-else","m-model"];removeAttribute(g,c);for(var d=0;d<a.$vdom.ifc.elsCol.length;d++){var b=offspring(a.$vdom.ifc.elsCol[d]);removeAttribute(b,c)}};var isIE=document.all;var isIE6=document.all&&!window.XMLHttpRequest;var isIE7=document.all&&!document.querySelector;
var isIE8=document.all&&!document.addEventListener;var isIE9=document.all&&!window.atob;if(isIE7){alert("您的瀏覽器版本太低，請升級您的瀏覽器！！！");window.onload=function(){var a=document.getElementsByTagName("body")[0];a.innerHTML="<p style='font-size:50px;text-align:center;font-weight:bold;color:red;'>IE8以下版本，不顯示內容！</p><p style='font-size:50px;text-align:center;font-weight:bold;color:red;'>請升級至IE8以上版本！</p>"}}if(!Array.prototype.forEach){Array.prototype.forEach=forEach}if(!document.getElementsByClassName){document.getElementsByClassName=function(a){var c={},b=0;var d=offspring(document.getElementsByTagName("body")[0]);d.forEach(function(g,f){var e=hasClass(d[f],a);if(e){c[b]=d[f];b++}});c.length=b;return c}}function forEach(){if(typeof arguments[0]=="function"){a(this,arguments[0])}else{a(arguments[0],arguments[1])}function a(b,f){if(b instanceof Array){for(var c=0;c<b.length;c++){f(b[c],c,b)}}else{var e=0;var d=b.length||objectLength(b);for(name in b){if(e<d){f(b[name],e,name,b);e++}}}}}function objectLength(){if(arguments.length==1){return a(arguments[0])}else{return a(this)}function a(b){var c=0;for(name in b){if(b.hasOwnProperty(name)){c++}}return c}}function join(){if(typeof arguments[0]=="string"){return a(this,arguments[0])}else{return a(arguments[0],arguments[1])}function a(c,b){var d="";var f=0;var e=c.length||objectLength(c);for(name in c){if(f<e){d=d+b+c[name];f++}}d.replace(b,"");return d}}function cloneObject(b){var a={};for(name in b){a[name]=b[name]}return a}function trim(a){return a.replace(/(^\s*)|(\s*$)/g,"")}function ltrim(a){return a.replace(/^\s+/,"")}function rtrim(a){return a.replace(/\s+$/,"")}function alltrim(a){return a.replace(/\s/g,"")}function remove(a){a.parentElement.removeChild(a)}function index(b){children=b.parentNode.children;for(var a in children){if(children[a]==b){return a}}}function offspringCollection(c){var d=[];if(c.children.length){d[0]=c.children;for(var b=0;b<d.length;b++){for(var a=0;a<d[b].length;a++){if(d[b][a].children.length){d.push(d[b][a].children)}}}}return d}function offspring(c){var a=[];if(!c.__mic__){c.__mic__={data:{},attributes:{}}}a[0]=c;var b=offspringCollection(c);if(b){b.forEach(function(h,g){for(var e=0;e<b[g].length;e++){if(b[g][e].__mic__){if(!b[g][e].__mic__.data){b[g][e].__mic__.data={}}if(!b[g][e].__mic__.attributes){b[g][e].__mic__.attributes={}}}else{b[g][e].__mic__={data:{},attributes:{}}}for(var d=0;d<b[g][e].attributes.length;d++){var f=b[g][e].attributes[d].name;var i=b[g][e].attributes[d].value;b[g][e].__mic__.attributes[f]=i}a.push(b[g][e])}})}return a}function nodesCollection(d){var b={};var g=0;for(var f=0;f<d.length;f++){var a=d[f].childNodes;for(var c=0;c<a.length;c++){var e=a[c].data;if(e&&(e.search("{{")>=0)&&(e.search("}}")>=0)){var j=/{{.+}}/ig;var h=j.exec(e);b[g]={index:c,node:a[c],parent:d[f],string:e,data:h};g++}}}b.length=g;return b}function collection(b,a){var c=[],e=[],d={};b.forEach(function(j,f){for(var h=0;h<j.attributes.length;h++){var g=j.attributes[h].name;if(a.length==1){if(g.substring(0,1)==a){e.push(j.attributes[h]);c.push(b[f])}}else{if(g==a){e.push(j.attributes[h]);c.push(b[f])}}}});d.elsCol=c;d.attCol=e;return d}function syncCollection(b,a){var c=[],e=[],f=[],d={};b.forEach(function(k,g){for(var j in k.__mic__.attributes){var h=j;if(a.length==1){if(h.substring(0,1)==a){f.push(j);e.push(k.__mic__.attributes[j]);c.push(b[g])}}else{if(h==a){f.push(j);e.push(k.__mic__.attributes[j]);c.push(b[g])}}}});d.elsCol=c;d.attCol=f;d.valCol=e;return d}function removeAttribute(c,d){if(d instanceof Object){if(!d.forEach){d.forEach=forEach}d.forEach(function(h,g){if(c.forEach){c.forEach(function(l,m){if(h.length==1){for(var k=0;k<l.attributes.length;k++){var j=l.attributes[k].name;if(j.substring(0,1)==h){l.removeAttribute(j)}}}else{l.removeAttribute(h)}})}else{if(h.length==1){for(var f=0;f<c.attributes.length;f++){var e=c.attributes[f].name;if(e.substring(0,1)==h){c.removeAttribute(e)}}}else{c.removeAttribute(h)}}})}else{if(c.forEach){c.forEach(function(g,h){if(d.length==1){for(var f=0;f<g.attributes.length;f++){var e=g.attributes[f].name;if(e.substring(0,1)==d){g.removeAttribute(e)}}}else{g.removeAttribute(d)}})}else{if(d.length==1){for(var b=0;b<c.attributes.length;b++){var a=c.attributes[b].name;if(a.substring(0,1)==d){c.removeAttribute(a)}}}else{c.removeAttribute(d)}}}}function strCompare(e){var b=["===","==","!==","!=",">=","<=",">","<","!"," and "," or ","&&","\\|\\|"];b=b.join("|");var a=e||join(this,"");var d=new RegExp("("+b+")","ig");d.exec(a);var c=[];if(RegExp.$1){c=a.split(RegExp.$1);c.push(RegExp.$1)}else{c=[a,"",""]}return c}function arrOE(c){var a=[],b=[];c.forEach(function(e,d){if(d%2){b.push(e)}else{a.push(e)}});return[a,b]}function strEval(h,f,e){if(!h){return""}if(Number(h)==h){return Number(h)}var c=["\\+","-","\\*","/","%"];c=c.join("|");var m=h||join(this,"");var k=new RegExp("("+c+")","ig");var d=m.match(k);if(!d){d=[]}var b=m.split(k);var j=[];if(isIE8){b.forEach(function(o,n){j.push(o,d[n])});j.pop()}else{j=b}j=arrOE(j);
var i=j[0];var g=j[1];i.forEach(function(x,s){if((typeof x=="string")&&(Number(x)!=x)&&(x.search(/^\'[\S\s]+\'$/)<0)){var u=/(\()|(\))/g;var w=trim(x);if(w.search(/^\([\S\s]+\)$/)>-1){w=trim(w.replace(/\(/g,"").replace(/\)/g,""))}w.match(u);var r=RegExp.$1;var v=RegExp.$2;w=trim(w.replace(/\(/g,"").replace(/\)/g,""));var o="";function t(D,z,y,B){var A="";if(B){for(var C=1;C<B.length;C++){D=D[B[C]]}}if(D instanceof Object){D=JSON.stringify(D)}if((typeof D=="string")&&(Number(D)!=D)&&(D.search(/^\'[\S\s]+\'$/)<0)){A=z+"'"+D+"'"+y}else{A=z+D+y}return A}if(w.search(/\./)>=0){var n=w.split(".");var q=n[0];if(f[q]!==undefined){o=f[q];i[s]=t(o,r,v,n)}else{if(e[q]!==undefined){o=e[q];i[s]=t(o,r,v,n)}}}else{if(w.search(/\[/)>=0){var n=w.split("[");for(var p=1;p<n.length;p++){if(n[p].search(/\]$/)>=0){n[p]=trim(n[p].replace(/\]$/,""))}else{throw new Error("請檢查你的m-text語句")}}var q=trim(n[0]);if(f[q]!==undefined){o=f[q];i[s]=t(o,r,v,n)}else{if(e[q]!==undefined){o=e[q];i[s]=t(o,r,v,n)}}}else{if(f[w]!==undefined){o=f[w];i[s]=t(o,r,v)}else{if(e[w]!==undefined){o=e[w];i[s]=t(o,r,v)}}}}}});var l=[],a="";i.forEach(function(o,n){l.push(o,g[n])});l.pop();a=l.join("");return a}function evalFor(h,n,c,l){var p=n[h].value.split(" in ");var d=[],e={},m={};var o=c[h];var a=o.parentNode;var g=o.__mic__.data[trim(p[1])]?o.__mic__.data[trim(p[1])]:l[trim(p[1])];var k=0;p[0]=alltrim(p[0].replace("(","").replace(")",""));if(p[0].search(",")){d=p[0].split(",")}else{d[0]=p[0]}if(g instanceof Array){for(var f=0;f<g.length;f++){e=o.cloneNode(true);removeAttribute(e,"m-for");a.insertBefore(e,o);m=collection(offspring(e),"m-for");forElsOS=m.elsCol;forAttOS=m.attCol;n=n.concat(forAttOS);c=c.concat(forElsOS);onForOS=offspring(e);onForOS.forEach(function(j,i){if(JSON.stringify(onForOS[i].parentNode.__mic__.data)!=="{}"){onForOS[i].__mic__.data=cloneObject(onForOS[i].parentNode.__mic__.data)}onForOS[i].__mic__.data[d[0]]=g[f];if(d[1]){onForOS[i].__mic__.data[d[1]]=f}})}a.removeChild(o)}else{if(g instanceof Object){for(var b in g){e=o.cloneNode(true);removeAttribute(e,"m-for");a.insertBefore(e,o);m=collection(offspring(e),"m-for");forElsOS=m.elsCol;forAttOS=m.attCol;n=n.concat(forAttOS);c=c.concat(forElsOS);onForOS=offspring(e);onForOS.forEach(function(j,i){if(onForOS[i].parentNode.__mic__.data){onForOS[i].__mic__.data=cloneObject(onForOS[i].parentNode.__mic__.data)}onForOS[i].__mic__.data[d[0]]=g[b];if(d[1]){onForOS[i].__mic__.data[d[1]]=k}if(d[2]){onForOS[i].__mic__.data[d[2]]=b}});k++}a.removeChild(o)}else{console.warn("數據格式錯誤！如若不影響顯示，可不用理會，否則請檢查代碼！")}}}function evalBraces(braces,root){var text="'"+braces.string.replace(/{{/g,"'+").replace(/}}/g,"+'")+"'";var parentData=braces.parent.__mic__.data;var tevn=strEval(text,parentData,root);tevn=tevn.replace(/\'\'\+/g,"").replace(/\+\'\'/g,"");try{tevn=eval(tevn)}catch(error){console.error("請檢查{{}}內語法錯誤！！！");tevn=""}braces.node.data=tevn}function evalText(i,textAttCol,textElsCol,root){var textEle=textElsCol[i];var textEleInfo=textEle.__mic__.data?textEle.__mic__.data:{};var textEleValue=textAttCol[i].value?textAttCol[i].value:textEle.__mic__.attributes["m-text"];var tevn=strEval(textEleValue,textEleInfo,root);tevn=tevn.replace(/\'\'\+/g,"").replace(/\+\'\'/g,"");try{tevn=eval(tevn)}catch(error){console.error("請檢查m-text語法錯誤！！！");tevn=""}textEle.innerText=tevn}function evalIf(i,ifc,root){var ifEle=ifc.elsCol[i];var comment=ifc.comments[i];var ifEleDate=ifEle.__mic__.data?ifEle.__mic__.data:{};var nextEle=ifEle.nextElementSibling||ifEle.nextSibling;var elseFlag=false;if(nextEle&&nextEle.attributes){for(var k=0;k<nextEle.attributes.length;k++){if(nextEle.attributes[k].name=="m-else"){elseFlag=true}}}var sc=strCompare(ifc.attCol[i].value);var scv1=trim(sc[0]);var scv2=trim(sc[1]);var evalS0=strEval(scv1,ifEleDate,root);var evalS1=strEval(scv2,ifEleDate,root);var evalS2="";if(sc[2]){evalS2=sc[2]}var comExp=evalS0+evalS2+evalS1;try{comExp=eval(comExp)}catch(error){console.error("請檢查m-if語法");comExp=false}root.$vdom.ifc=ifc;if(!comExp){ifEle.parent.insertBefore(comment,ifEle);ifEle.parent.removeChild(ifEle)}else{if(comment.parentElement){ifEle.parent.insertBefore(ifEle,comment);ifEle.parent.removeChild(comment)}if(elseFlag){ifEle.parentNode.removeChild(nextEle)}}}function modelTextEval(root,coll,value,pattern){root[value]=root[value].replace(/\\/g,"\\\\").replace(/\'/g,"\\'");if(coll){for(var i=0;i<coll.attCol.length;i++){var collElement=coll.elsCol[i];if(collElement.__mic__.text.search(pattern)>=0){var tevn=strEval(collElement.__mic__.text,collElement.__mic__.data,root);tevn=tevn.replace(/\'\'\+/g,"").replace(/\+\'\'/g,"");if(tevn=="'+\\'\\''"){tevn="''"}try{tevn=eval(tevn)}catch(error){console.error("請檢查m-text語法錯誤！！！");tevn=""}collElement.innerText=tevn}}}}function modelBracesEval(root,coll,value,pattern){root[value]=root[value].replace(/\\/g,"\\\\").replace(/\'/g,"\\'");if(coll){for(var i=0;i<coll.length;i++){var collElement=coll[i].parent;if(collElement.__mic__.attributes.braces.string.search(pattern)>=0){var tevn=strEval(collElement.__mic__.attributes.braces.string,collElement.__mic__.data,root);
tevn=tevn.replace(/\'\'\+/g,"").replace(/\+\'\'/g,"");if(tevn=="'+\\'\\''"){tevn="''"}try{tevn=eval(tevn)}catch(error){console.error("請檢查{{}}內語法錯誤！！！");tevn=""}coll[i].node.data=tevn}}}};