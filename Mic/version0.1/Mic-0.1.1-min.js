var mic=function(obj){return new Mic(obj)};function Mic(obj){if(obj.data){for(name in obj.data){if((typeof obj.data[name]=="function")){console.error("data內請不要定義函數");return false}else{this[name]=obj.data[name]}}}if(obj.methods){for(name in obj.methods){if(typeof obj.methods[name]=="function"){this[name]=obj.methods[name]}else{console.error("methods內請定義函數");return false}}}if(obj.created){obj.created.call(this);obj.created()}var element=document.getElementById(obj.el.substr(1));var eleOffspring=offspring(element);var forCollection=collection(eleOffspring,"m-for");var forAttCol=forCollection.attCol;var forElsCol=forCollection.elsCol;if(forCollection){for(var i=0;i<forAttCol.length;i++){var forParam=forAttCol[i].value.split(" in ");var param=[],forEls={},forOS={};var forEle=forElsCol[i];var forParent=forEle.parentNode;var obj=forEle.micData&&forEle.micData[trim(forParam[1])]?forEle.micData[trim(forParam[1])]:this[trim(forParam[1])];var count=0;forParam[0]=alltrim(forParam[0].replace("(","").replace(")",""));if(forParam[0].search(",")){param=forParam[0].split(",")}else{param[0]=forParam[0]}if(obj instanceof Array){for(var j=0;j<obj.length;j++){forEls=forEle.cloneNode(true);removeAttribute(forEls,"m-for");forParent.insertBefore(forEls,forEle);forOS=collection(offspring(forEls),"m-for");forElsOS=forOS.elsCol;forAttOS=forOS.attCol;forAttCol=forAttCol.concat(forAttOS);forElsCol=forElsCol.concat(forElsOS);onForOS=offspring(forEls);onForOS.forEach(function(item,index){if(onForOS[index].parentNode.micData){onForOS[index].micData=cloneObject(onForOS[index].parentNode.micData)}else{onForOS[index].micData={}}onForOS[index].micData[param[0]]=obj[j];if(param[1]){onForOS[index].micData[param[1]]=j}})}forParent.removeChild(forEle)}else{if(obj instanceof Object){for(var name in obj){forEls=forEle.cloneNode(true);removeAttribute(forEls,"m-for");forParent.insertBefore(forEls,forEle);forOS=collection(offspring(forEls),"m-for");forElsOS=forOS.elsCol;forAttOS=forOS.attCol;forAttCol=forAttCol.concat(forAttOS);forElsCol=forElsCol.concat(forElsOS);onForOS=offspring(forEls);onForOS.forEach(function(item,index){if(onForOS[index].parentNode.micData){onForOS[index].micData=cloneObject(onForOS[index].parentNode.micData)}else{onForOS[index].micData={}}onForOS[index].micData[param[0]]=obj[name];if(param[1]){onForOS[index].micData[param[1]]=count}if(param[2]){onForOS[index].micData[param[2]]=name}});count++}forParent.removeChild(forEle)}else{console.warn("數據格式錯誤！如若不影響顯示，可不用理會，否則請檢查代碼！")}}}}eleOffspring=offspring(element);for(var i=0;i<eleOffspring.length;i++){var that=this;var flag=false;if((eleOffspring[i].innerHTML==eleOffspring[i].innerText)&&(eleOffspring[i].innerText.search("{{")>=0)&&(eleOffspring[i].innerText.search("}}")>=0)){flag=false;var text="'"+eleOffspring[i].innerText.replace(/{{/g,"'+").replace(/}}/g,"+'")+"'";for(name in eleOffspring[i].attributes){if(eleOffspring[i].attributes[name].name=="m-text"){flag=true}}if(!flag){eleOffspring[i].setAttribute("m-text",text)}}}var textCollection=collection(eleOffspring,"m-text");var textAttCol=textCollection.attCol;var textElsCol=textCollection.elsCol;if(textCollection){var that=this;for(var i=0;i<textAttCol.length;i++){var textEle=textElsCol[i];var textEleInfo=textEle.micData?textEle.micData:{};var textEleValue=textAttCol[i].value;var tevn=strEval(textEleValue,textEleInfo,that);tevn=tevn.replace(/\'\'\+/g,"").replace(/\+\'\'/g,"");try{tevn=eval(tevn)}catch(error){console.error("請檢查m-text語法錯誤！！！");tevn=""}textEle.innerText=tevn}}eleOffspring=offspring(element);var ifCollection=collection(eleOffspring,"m-if");var ifAttCol=ifCollection.attCol;var ifElsCol=ifCollection.elsCol;if(ifCollection){var that=this;for(var i=0;i<ifAttCol.length;i++){var ifEle=ifElsCol[i];var ifEleDate=ifEle.micData?ifEle.micData:{};var nextEle=ifEle.nextElementSibling;var elseFlag=false;if(nextEle&&nextEle.attributes){for(var k=0;k<nextEle.attributes.length;k++){if(nextEle.attributes[k].name=="m-else"){elseFlag=true}}}var sc=strCompare(ifAttCol[i].value);var scv1=trim(sc[0]);var scv2=trim(sc[1]);var evalS0=strEval(scv1,ifEleDate,that);var evalS1=strEval(scv2,ifEleDate,that);var evalS2="";if(sc[2]){evalS2=sc[2]}var comExp=evalS0+evalS2+evalS1;try{comExp=eval(comExp)}catch(error){console.error("請檢查m-if語法");comExp=false}if(!comExp){ifEle.parentNode.removeChild(ifEle)}else{if(elseFlag){ifEle.parentNode.removeChild(nextEle)}}}}eleOffspring=offspring(element);var modelCollection=collection(eleOffspring,"m-model");var modelAttCol=modelCollection.attCol;var modelElsCol=modelCollection.elsCol;textCollection=collection(eleOffspring,"m-text");textAttCol=textCollection.attCol;textElsCol=textCollection.elsCol;if(modelCollection){var that=this;for(var i=0;i<modelAttCol.length;i++){var modelEle=modelElsCol[i];var modelEleValue=modelAttCol[i].value;modelEle.value=that[modelEleValue];var pattern=new RegExp("(\\+|-|\\*|/|%|s|(|^)+"+modelEleValue+"(\\+|-|\\*|/|%|s|)|$)+");if(textCollection){for(var i=0;i<textAttCol.length;i++){var textEle=textElsCol[i];
var textEleInfo=textEle.micData?textEle.micData:{};var textEleValue=textAttCol[i].value;if(textEleValue.search(pattern)>=0){textEle.micActiveData={};textEle.micActiveData.data=cloneObject(textEleInfo);textEle.micActiveData.text=textEleValue}}}modelEle.oninput=function(){that[modelEleValue]=this.value?this.value:"+''";that[modelEleValue]=that[modelEleValue].replace(/\\/g,"\\\\").replace(/\'/g,"\\'");if(textCollection){for(var i=0;i<textAttCol.length;i++){var textElement=textElsCol[i];if(textElement.micActiveData.text.search(pattern)>=0){var tevn=strEval(textElement.micActiveData.text,textElement.micActiveData.data,that);tevn=tevn.replace(/\'\'\+/g,"").replace(/\+\'\'/g,"");if(tevn=="'+\\'\\''"){tevn="''"}try{tevn=eval(tevn)}catch(error){console.error("請檢查m-text語法錯誤！！！");tevn=""}textElement.innerText=tevn}}}}}}if(obj.mounted){obj.mounted.call(this);obj.mounted()}var attributes=["m-text","m-if","@",":","m-else","m-model"];removeAttribute(eleOffspring,attributes);eleOffspring.forEach(function(item,index){delete (eleOffspring[index].micData)})}function objectLength(){if(arguments.length==1){return returnValue(arguments[0])}else{return returnValue(this)}function returnValue(object){var count=0;for(name in object){if(object.hasOwnProperty(name)){count++}}return count}}function join(){if(typeof arguments[0]=="string"){return returnValue(this,arguments[0])}else{return returnValue(arguments[0],arguments[1])}function returnValue(object,string){var newString="";var count=0;var length=object.length||objectLength(object);for(name in object){if(count<length){newString=newString+string+object[name];count++}}newString.replace(string,"");return newString}}function cloneObject(obj){var newObj={};for(name in obj){newObj[name]=obj[name]}return newObj}function trim(string){return string.replace(/(^\s*)|(\s*$)/g,"")}function ltrim(string){return string.replace(/^\s+/,"")}function rtrim(string){return string.replace(/\s+$/,"")}function alltrim(string){return string.replace(/\s/g,"")}function remove(ele){ele.parentElement.removeChild(ele)}function offspringCollection(ele){var offspringCollection=[];if(ele.children.length){offspringCollection[0]=ele.children;for(var i=0;i<offspringCollection.length;i++){for(var j=0;j<offspringCollection[i].length;j++){if(offspringCollection[i][j].children.length){offspringCollection.push(offspringCollection[i][j].children)}}}}return offspringCollection}function offspring(ele){var els=[];els[0]=ele;var offsprings=offspringCollection(ele);if(offsprings){offsprings.forEach(function(item,index){for(var k=0;k<offsprings[index].length;k++){els.push(offsprings[index][k])}})}return els}function collection(els,attr){var elsCol=[],attCol=[],collection={};els.forEach(function(item,index){for(var i=0;i<item.attributes.length;i++){var attrName=item.attributes[i].name;if(attr.length==1){if(attrName.substring(0,1)==attr){attCol.push(item.attributes[i]);elsCol.push(els[index])}}else{if(attrName==attr){attCol.push(item.attributes[i]);elsCol.push(els[index])}}}});collection.elsCol=elsCol;collection.attCol=attCol;return collection}function removeAttribute(els,attribute){if(attribute instanceof Object){if(!attribute.forEach){attribute.forEach=forEach}attribute.forEach(function(attrItem,attrIndex){if(els.forEach){els.forEach(function(elsItem,elsIndex){if(attrItem.length==1){for(var i=0;i<elsItem.attributes.length;i++){var attrName=elsItem.attributes[i].name;if(attrName.substring(0,1)==attrItem){elsItem.removeAttribute(attrName)}}}else{elsItem.removeAttribute(attrItem)}})}else{if(attrItem.length==1){for(var i=0;i<els.attributes.length;i++){var attrName=els.attributes[i].name;if(attrName.substring(0,1)==attrItem){els.removeAttribute(attrName)}}}else{els.removeAttribute(attrItem)}}})}else{if(els.forEach){els.forEach(function(elsItem,elsIndex){if(attribute.length==1){for(var i=0;i<elsItem.attributes.length;i++){var attrName=elsItem.attributes[i].name;if(attrName.substring(0,1)==attribute){elsItem.removeAttribute(attrName)}}}else{elsItem.removeAttribute(attribute)}})}else{if(attribute.length==1){for(var i=0;i<els.attributes.length;i++){var attrName=els.attributes[i].name;if(attrName.substring(0,1)==attribute){els.removeAttribute(attrName)}}}else{els.removeAttribute(attribute)}}}}function strCompare(string){var operator=["===","==","!==","!=",">=","<=",">","<","!"," and "," or ","&&","\\|\\|"];operator=operator.join("|");var self=string||join(this,"");var regExp=new RegExp("("+operator+")","ig");regExp.exec(self);var compareArray=[];if(RegExp.$1){compareArray=self.split(RegExp.$1);compareArray.push(RegExp.$1)}else{compareArray=[self,"",""]}return compareArray}function arrOE(array){var odd=[],even=[];array.forEach(function(item,index){if(index%2){even.push(item)}else{odd.push(item)}});return[odd,even]}function strEval(string,obj1,obj2){if(!string){return""}if(Number(string)==string){return Number(string)}var operator=["\\+","-","\\*","/","%"];operator=operator.join("|");var self=string||join(this,"");var regExp=new RegExp("("+operator+")","ig");
var regArray=self.match(regExp);var splitArray=self.split(regExp);var evalArray=splitArray;evalArray=arrOE(evalArray);var strArray=evalArray[0];var operatorArray=evalArray[1];strArray.forEach(function(item,index){if((typeof item=="string")&&(Number(item)!=item)&&(item.search(/^\'[\S\s]+\'$/)<0)){var pattern=/(\()|(\))/g;var text=trim(item);if(text.search(/^\([\S\s]+\)$/)>-1){text=trim(text.replace(/\(/g,"").replace(/\)/g,""))}text.match(pattern);var lre=RegExp.$1;var rre=RegExp.$2;text=trim(text.replace(/\(/g,"").replace(/\)/g,""));var val="";function innerEval(val,lre,rre,textArray){var variable="";if(textArray){for(var i=1;i<textArray.length;i++){val=val[textArray[i]]}}if(val instanceof Object){val=JSON.stringify(val)}if((typeof val=="string")&&(Number(val)!=val)&&(val.search(/^\'[\S\s]+\'$/)<0)){variable=lre+"'"+val+"'"+rre}else{variable=lre+val+rre}return variable}if(text.search(/\./)>=0){var textArray=text.split(".");var ta=textArray[0];if(obj1[ta]!==undefined){val=obj1[ta];strArray[index]=innerEval(val,lre,rre,textArray)}else{if(obj2[ta]!==undefined){val=obj2[ta];strArray[index]=innerEval(val,lre,rre,textArray)}}}else{if(text.search(/\[/)>=0){var textArray=text.split("[");for(var i=1;i<textArray.length;i++){if(textArray[i].search(/\]$/)>=0){textArray[i]=trim(textArray[i].replace(/\]$/,""))}else{throw new Error("請檢查你的m-text語句")}}var ta=trim(textArray[0]);if(obj1[ta]!==undefined){val=obj1[ta];strArray[index]=innerEval(val,lre,rre,textArray)}else{if(obj2[ta]!==undefined){val=obj2[ta];strArray[index]=innerEval(val,lre,rre,textArray)}}}else{if(obj1[text]!==undefined){val=obj1[text];strArray[index]=innerEval(val,lre,rre)}else{if(obj2[text]!==undefined){val=obj2[text];strArray[index]=innerEval(val,lre,rre)}}}}}});var tva=[],tvs="";strArray.forEach(function(item,index){tva.push(item,operatorArray[index])});tva.pop();tvs=tva.join("");return tvs};