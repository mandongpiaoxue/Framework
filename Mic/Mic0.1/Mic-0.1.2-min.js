var mic=function(a){return new Mic(a)};function Mic(obj){if(obj.data){for(name in obj.data){if((typeof obj.data[name]=="function")){console.error("data內請不要定義函數");return false}else{this[name]=obj.data[name]}}}if(obj.methods){for(name in obj.methods){if(typeof obj.methods[name]=="function"){this[name]=obj.methods[name]}else{console.error("methods內請定義函數");return false}}}if(obj.created){obj.created.call(this);}var element=document.getElementById(obj.el.substr(1));var eleOffspring=offspring(element);var forCollection=collection(eleOffspring,"m-for");var forAttCol=forCollection.attCol;var forElsCol=forCollection.elsCol;if(forCollection){for(var i=0;i<forAttCol.length;i++){var forParam=forAttCol[i].value.split(" in ");var param=[],forEls={},forOS={};var forEle=forElsCol[i];var forParent=forEle.parentNode;var obj=forEle.micData&&forEle.micData[trim(forParam[1])]?forEle.micData[trim(forParam[1])]:this[trim(forParam[1])];var count=0;forParam[0]=alltrim(forParam[0].replace("(","").replace(")",""));if(forParam[0].search(",")){param=forParam[0].split(",")}else{param[0]=forParam[0]}if(obj instanceof Array){for(var j=0;j<obj.length;j++){forEls=forEle.cloneNode(true);removeAttribute(forEls,"m-for");forParent.insertBefore(forEls,forEle);forOS=collection(offspring(forEls),"m-for");forElsOS=forOS.elsCol;forAttOS=forOS.attCol;forAttCol=forAttCol.concat(forAttOS);forElsCol=forElsCol.concat(forElsOS);onForOS=offspring(forEls);onForOS.forEach(function(item,index){if(onForOS[index].parentNode.micData){onForOS[index].micData=cloneObject(onForOS[index].parentNode.micData)}else{onForOS[index].micData={}}onForOS[index].micData[param[0]]=obj[j];if(param[1]){onForOS[index].micData[param[1]]=j}})}forParent.removeChild(forEle)}else{if(obj instanceof Object){for(var name in obj){forEls=forEle.cloneNode(true);removeAttribute(forEls,"m-for");forParent.insertBefore(forEls,forEle);forOS=collection(offspring(forEls),"m-for");forElsOS=forOS.elsCol;forAttOS=forOS.attCol;forAttCol=forAttCol.concat(forAttOS);forElsCol=forElsCol.concat(forElsOS);onForOS=offspring(forEls);onForOS.forEach(function(item,index){if(onForOS[index].parentNode.micData){onForOS[index].micData=cloneObject(onForOS[index].parentNode.micData)}else{onForOS[index].micData={}}onForOS[index].micData[param[0]]=obj[name];if(param[1]){onForOS[index].micData[param[1]]=count}if(param[2]){onForOS[index].micData[param[2]]=name}});count++}forParent.removeChild(forEle)}else{console.warn("數據格式錯誤！如若不影響顯示，可不用理會，否則請檢查代碼！")}}}}eleOffspring=offspring(element);var braces=nodesCollection(eleOffspring);for(var i=0;i<braces.length;i++){var that=this;var text="'"+braces[i].data.replace(/{{/g,"'+").replace(/}}/g,"+'")+"'";braces[i].data=text;var parentData=braces[i].parent.micData;var tevn=strEval(text,parentData,that);tevn=tevn.replace(/\'\'\+/g,"").replace(/\+\'\'/g,"");try{tevn=eval(tevn)}catch(error){console.error("請檢查{{}}內語法錯誤！！！");tevn=""}braces[i].node.data=tevn}var textCollection=collection(eleOffspring,"m-text");var textAttCol=textCollection.attCol;var textElsCol=textCollection.elsCol;if(textCollection){var that=this;for(var i=0;i<textAttCol.length;i++){var textEle=textElsCol[i];var textEleInfo=textEle.micData?textEle.micData:{};var textEleValue=textAttCol[i].value;var tevn=strEval(textEleValue,textEleInfo,that);tevn=tevn.replace(/\'\'\+/g,"").replace(/\+\'\'/g,"");try{tevn=eval(tevn)}catch(error){console.error("請檢查m-text語法錯誤！！！");tevn=""}textEle.innerText=tevn}}eleOffspring=offspring(element);var ifCollection=collection(eleOffspring,"m-if");var ifAttCol=ifCollection.attCol;var ifElsCol=ifCollection.elsCol;if(ifCollection){var that=this;for(var i=0;i<ifAttCol.length;i++){var ifEle=ifElsCol[i];var ifEleDate=ifEle.micData?ifEle.micData:{};var nextEle=ifEle.nextElementSibling||ifEle.nextSibling;var elseFlag=false;if(nextEle&&nextEle.attributes){for(var k=0;k<nextEle.attributes.length;k++){if(nextEle.attributes[k].name=="m-else"){elseFlag=true}}}var sc=strCompare(ifAttCol[i].value);var scv1=trim(sc[0]);var scv2=trim(sc[1]);var evalS0=strEval(scv1,ifEleDate,that);var evalS1=strEval(scv2,ifEleDate,that);var evalS2="";if(sc[2]){evalS2=sc[2]}var comExp=evalS0+evalS2+evalS1;try{comExp=eval(comExp)}catch(error){console.error("請檢查m-if語法");comExp=false}if(!comExp){ifEle.parentNode.removeChild(ifEle)}else{if(elseFlag){ifEle.parentNode.removeChild(nextEle)}}}}eleOffspring=offspring(element);var modelCollection=collection(eleOffspring,"m-model");var modelAttCol=modelCollection.attCol;var modelElsCol=modelCollection.elsCol;textCollection=collection(eleOffspring,"m-text");textAttCol=textCollection.attCol;textElsCol=textCollection.elsCol;if(modelCollection){var that=this;var modelEle={};for(var i=0;i<modelAttCol.length;i++){modelEle=modelElsCol[i];var modelEleValue=modelAttCol[i].value;var pattern=new RegExp("(\\+|-|\\*|/|%|s|(|^)+"+modelEleValue+"(\\+|-|\\*|/|%|s|)|$)+");modelEle.value=that[modelEleValue];if(textCollection){for(var j=0;j<textAttCol.length;j++){var textEle=textElsCol[j];var textEleValue=textAttCol[j].value;
if(textEleValue.search(pattern)>=0){if(!textEle.micActiveData){textEle.micActiveData={}}if(!textEle.micActiveData.data){textEle.micActiveData.data=cloneObject(textEle.micData)}textEle.micActiveData.text=textEleValue}}}if(braces){var count=0;for(var k=0;k<braces.length;k++){if(braces[k].parent){if(braces[k].data.search(pattern)>=0){if(!braces[k].parent.micActiveData){braces[k].parent.micActiveData={}}braces[k].parent.micActiveData.braces=braces[k].data;if(!braces[k].parent.micActiveData.data){braces[k].parent.micActiveData.data=cloneObject(braces[k].parent.micData)}}}}}if(!modelEle.micActiveData){modelEle.micActiveData={}}modelEle.micActiveData.braces=modelEleValue;if(!modelEle.micActiveData.data){modelEle.micActiveData.data=cloneObject(modelEle.micData)}if(modelEle.oninput!==undefined){if(isIE9){modelEle.onkeydown=function(e){if((e.keyCode==8)||(e.keyCode==46)||(e.ctrlKey&&e.keyCode==88)){modelEle.fireEvent("onkeyup")}};modelEle.onkeyup=function(e){modelEle.fireEvent("oninput")}}modelEle.oninput=function(){modelEleValue=this.micActiveData.braces;that[modelEleValue]=this.value?this.value:"+''";modelTextEval(that,textCollection,modelEleValue);modelBracesEval(that,braces,modelEleValue)}}else{modelEle.onpropertychange=function(){modelEleValue=this.micActiveData.braces;that[modelEleValue]=this.value?this.value:"+''";modelTextEval(that,textCollection,modelEleValue);modelBracesEval(that,braces,modelEleValue)}}}}function modelTextEval(that,coll,value){that[value]=that[value].replace(/\\/g,"\\\\").replace(/\'/g,"\\'");if(coll){for(var i=0;i<coll.attCol.length;i++){var collElement=coll.elsCol[i];if(collElement.micActiveData.text.search(pattern)>=0){var tevn=strEval(collElement.micActiveData.text,collElement.micActiveData.data,that);tevn=tevn.replace(/\'\'\+/g,"").replace(/\+\'\'/g,"");if(tevn=="'+\\'\\''"){tevn="''"}try{tevn=eval(tevn)}catch(error){console.error("請檢查m-text語法錯誤！！！");tevn=""}collElement.innerText=tevn}}}}function modelBracesEval(that,coll,value){that[value]=that[value].replace(/\\/g,"\\\\").replace(/\'/g,"\\'");if(coll){for(var i=0;i<coll.length;i++){var collElement=coll[i].parent;if(collElement.micActiveData.braces.search(pattern)>=0){var tevn=strEval(collElement.micActiveData.braces,collElement.micActiveData.data,that);tevn=tevn.replace(/\'\'\+/g,"").replace(/\+\'\'/g,"");if(tevn=="'+\\'\\''"){tevn="''"}try{tevn=eval(tevn)}catch(error){console.error("請檢查m-text語法錯誤！！！");tevn=""}coll[i].node.data=tevn}}}}if(obj.mounted){obj.mounted.call(this);}var attributes=["m-text","m-if","@",":","m-else","m-model"];removeAttribute(eleOffspring,attributes);eleOffspring.forEach(function(item,index){try{delete (eleOffspring[index].micData)}catch(error){eleOffspring[index].micData={}}})}var isIE=document.all;var isIE6=document.all&&!window.XMLHttpRequest;var isIE7=document.all&&!document.querySelector;var isIE8=document.all&&!document.addEventListener;var isIE9=document.all&&!window.atob;if(isIE7){alert("您的瀏覽器版本太低，請升級您的瀏覽器！！！");window.onload=function(){var a=document.getElementsByTagName("body")[0];a.innerHTML="<p style='font-size:50px;text-align:center;font-weight:bold;color:red;'>IE8以下版本，不顯示內容！</p><p style='font-size:50px;text-align:center;font-weight:bold;color:red;'>請升級至IE8以上版本！</p>"}}if(!Array.prototype.forEach){Array.prototype.forEach=forEach}if(!document.getElementsByClassName){document.getElementsByClassName=function(a){var c={},b=0;var d=offspring(document.getElementsByTagName("body")[0]);d.forEach(function(g,f){var e=hasClass(d[f],a);if(e){c[b]=d[f];b++}});c.length=b;return c}}function forEach(){if(typeof arguments[0]=="function"){a(this,arguments[0])}else{a(arguments[0],arguments[1])}function a(b,f){if(b instanceof Array){for(var c=0;c<b.length;c++){f(b[c],c,b)}}else{var e=0;var d=b.length||objectLength(b);for(name in b){if(e<d){f(b[name],e,name,b);e++}}}}}function objectLength(){if(arguments.length==1){return a(arguments[0])}else{return a(this)}function a(b){var c=0;for(name in b){if(b.hasOwnProperty(name)){c++}}return c}}function join(){if(typeof arguments[0]=="string"){return a(this,arguments[0])}else{return a(arguments[0],arguments[1])}function a(c,b){var d="";var f=0;var e=c.length||objectLength(c);for(name in c){if(f<e){d=d+b+c[name];f++}}d.replace(b,"");return d}}function cloneObject(b){var a={};for(name in b){a[name]=b[name]}return a}function trim(a){return a.replace(/(^\s*)|(\s*$)/g,"")}function ltrim(a){return a.replace(/^\s+/,"")}function rtrim(a){return a.replace(/\s+$/,"")}function alltrim(a){return a.replace(/\s/g,"")}function remove(a){a.parentElement.removeChild(a)}function offspringCollection(c){var d=[];if(c.children.length){d[0]=c.children;for(var b=0;b<d.length;b++){for(var a=0;a<d[b].length;a++){if(d[b][a].children.length){d.push(d[b][a].children)}}}}return d}function offspring(c){var a=[];a[0]=c;var b=offspringCollection(c);if(b){b.forEach(function(f,e){for(var d=0;d<b[e].length;d++){a.push(b[e][d])}})}return a}function nodesCollection(d){var e={};var f=0;for(var c=0;c<d.length;
c++){var b=d[c].childNodes;for(var a=0;a<b.length;a++){var g=b[a].data;if(g&&(g.search("{{")>=0)&&(g.search("}}")>=0)){e[f]={index:a,node:b[a],parent:d[c],data:g};f++}}}e.length=f;return e}function collection(b,a){var c=[],e=[],d={};b.forEach(function(j,f){for(var h=0;h<j.attributes.length;h++){var g=j.attributes[h].name;if(a.length==1){if(g.substring(0,1)==a){e.push(j.attributes[h]);c.push(b[f])}}else{if(g==a){e.push(j.attributes[h]);c.push(b[f])}}}});d.elsCol=c;d.attCol=e;return d}function removeAttribute(c,d){if(d instanceof Object){if(!d.forEach){d.forEach=forEach}d.forEach(function(h,g){if(c.forEach){c.forEach(function(l,m){if(h.length==1){for(var k=0;k<l.attributes.length;k++){var j=l.attributes[k].name;if(j.substring(0,1)==h){l.removeAttribute(j)}}}else{l.removeAttribute(h)}})}else{if(h.length==1){for(var f=0;f<c.attributes.length;f++){var e=c.attributes[f].name;if(e.substring(0,1)==h){c.removeAttribute(e)}}}else{c.removeAttribute(h)}}})}else{if(c.forEach){c.forEach(function(g,h){if(d.length==1){for(var f=0;f<g.attributes.length;f++){var e=g.attributes[f].name;if(e.substring(0,1)==d){g.removeAttribute(e)}}}else{g.removeAttribute(d)}})}else{if(d.length==1){for(var b=0;b<c.attributes.length;b++){var a=c.attributes[b].name;if(a.substring(0,1)==d){c.removeAttribute(a)}}}else{c.removeAttribute(d)}}}}function strCompare(e){var b=["===","==","!==","!=",">=","<=",">","<","!"," and "," or ","&&","\\|\\|"];b=b.join("|");var a=e||join(this,"");var d=new RegExp("("+b+")","ig");d.exec(a);var c=[];if(RegExp.$1){c=a.split(RegExp.$1);c.push(RegExp.$1)}else{c=[a,"",""]}return c}function arrOE(c){var a=[],b=[];c.forEach(function(e,d){if(d%2){b.push(e)}else{a.push(e)}});return[a,b]}function strEval(h,f,e){if(!h){return""}if(Number(h)==h){return Number(h)}var c=["\\+","-","\\*","/","%"];c=c.join("|");var m=h||join(this,"");var k=new RegExp("("+c+")","ig");var d=m.match(k);if(!d){d=[]}var b=m.split(k);var j=[];if(isIE8){b.forEach(function(o,n){j.push(o,d[n])});j.pop()}else{j=b}j=arrOE(j);var i=j[0];var g=j[1];i.forEach(function(x,s){if((typeof x=="string")&&(Number(x)!=x)&&(x.search(/^\'[\S\s]+\'$/)<0)){var u=/(\()|(\))/g;var w=trim(x);if(w.search(/^\([\S\s]+\)$/)>-1){w=trim(w.replace(/\(/g,"").replace(/\)/g,""))}w.match(u);var r=RegExp.$1;var v=RegExp.$2;w=trim(w.replace(/\(/g,"").replace(/\)/g,""));var o="";function t(D,z,y,B){var A="";if(B){for(var C=1;C<B.length;C++){D=D[B[C]]}}if(D instanceof Object){D=JSON.stringify(D)}if((typeof D=="string")&&(Number(D)!=D)&&(D.search(/^\'[\S\s]+\'$/)<0)){A=z+"'"+D+"'"+y}else{A=z+D+y}return A}if(w.search(/\./)>=0){var n=w.split(".");var q=n[0];if(f[q]!==undefined){o=f[q];i[s]=t(o,r,v,n)}else{if(e[q]!==undefined){o=e[q];i[s]=t(o,r,v,n)}}}else{if(w.search(/\[/)>=0){var n=w.split("[");for(var p=1;p<n.length;p++){if(n[p].search(/\]$/)>=0){n[p]=trim(n[p].replace(/\]$/,""))}else{throw new Error("請檢查你的m-text語句")}}var q=trim(n[0]);if(f[q]!==undefined){o=f[q];i[s]=t(o,r,v,n)}else{if(e[q]!==undefined){o=e[q];i[s]=t(o,r,v,n)}}}else{if(f[w]!==undefined){o=f[w];i[s]=t(o,r,v)}else{if(e[w]!==undefined){o=e[w];i[s]=t(o,r,v)}}}}}});var l=[],a="";i.forEach(function(o,n){l.push(o,g[n])});l.pop();a=l.join("");return a};